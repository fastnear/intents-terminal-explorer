<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>NEARx – Web</title>

    <link rel="stylesheet" href="./theme.css" />

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: var(--bg, #0b0e14);
        color: var(--fg, #e6edf3);
        font-family: "SF Mono", Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 20px;  /* Base font size (matches theme.css:42) */
      }

      /* Screen reader only content */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      #nearx-root {
        display: flex;
        flex-direction: column;
        height: 100vh;
        padding: 8px;
        box-sizing: border-box;
        gap: 2px; /* Minimal gaps like TUI */
      }

      /* Filter row */

      #nearx-filter-row {
        height: 32px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      #nearx-filter {
        flex: 1;
        padding: 4px 8px;
        border-radius: 0; /* Square corners for DOS feel */
        border: 1px solid var(--border, #5d636d);
        background: var(--panel, #0f131a);
        color: inherit;
        font-size: 18px;  /* matches pane body font for consistency */
      }

      /* Body layout: top row (blocks+tx) + bottom row (details) */

      #nearx-body {
        flex: 1;
        min-height: 0;
        display: grid;
        grid-template-rows: 60% 40%;
        gap: 2px; /* Minimal gaps like TUI */
      }

      @media (max-width: 800px) {
        #nearx-body {
          grid-template-rows: 25% 25% 50%;
        }
      }

      #nearx-top-row {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 2px; /* Minimal gaps like TUI */
      }

      @media (max-width: 800px) {
        #nearx-top-row {
          display: block;
        }
      }

      /* Panes */

      .nx-pane {
        border-radius: 0; /* Square corners for DOS feel */
        background: var(--panel, #0f131a);
        border: 1px solid var(--border, #5d636d);
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .nx-pane--focused {
        /* DOS aesthetic: yellow top border only (match TUI), gray sides/bottom */
        border-top: 2px solid var(--accent-strong, #ffcc00);
        border-left: 1px solid var(--border, #5d636d);
        border-right: 1px solid var(--border, #5d636d);
        border-bottom: 1px solid var(--border, #5d636d);
        background: var(--panel-alt, #1a2030);
        margin-top: -1px; /* Compensate for 2px top border to prevent layout shift */
      }

      .nx-pane--focused .nx-pane-title {
        color: var(--accent-strong, #ffcc00);
      }

      /* Removed focus-visible outline - using custom .nx-pane--focused instead */
      /* .nx-pane:focus-visible {
        outline: 2px solid var(--accent-strong, #ffcc00);
        outline-offset: -4px;
      } */

      .nx-pane-title {
        padding: 2px 8px;
        font-size: 19px;  /* smaller than body (20px) for visual hierarchy */
        border-bottom: 1px solid var(--border, #5d636d);
        color: var(--fg-dim, #9ca3af);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .nx-pane-body {
        flex: 1;
        min-height: 0;
        overflow: auto;
        padding: 2px 0;
        font-size: 18px;  /* slightly smaller than body (20px) for dense lists */
      }

      .nx-row {
        padding: 2px 8px;
        cursor: pointer; /* Indicate clickable */
        user-select: none; /* Prevent accidental text selection on click */
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }

      .nx-row:hover {
        background: var(--hover-bg, #151b23);
      }

      .nx-row--selected {
        background: var(--sel-bg, #1e2a3a);
        font-weight: bold; /* Match TUI Modifier::BOLD */
      }

      /* Chevron prefix (match TUI highlight_symbol) */
      .nx-row--selected::before {
        content: "› ";
        color: var(--accent-strong, #ffcc00); /* Yellow for better contrast */
        font-weight: bold;
      }

      /* Reduce selection background when pane unfocused (text stays same) */
      .nx-pane:not(.nx-pane--focused) .nx-row--selected {
        background: rgba(30, 42, 58, 0.5); /* 50% of --sel-bg */
      }

      /* Full background when pane focused */
      .nx-pane--focused .nx-row--selected {
        background: var(--sel-bg, #1e2a3a);
      }

      /* Details JSON view */

      #pane-details-pre {
        flex: 1;
        margin: 0;
        padding: 4px 8px;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo,
          Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 18px;  /* slightly smaller than body (20px) for dense JSON */
        line-height: 1.4;
        white-space: pre;
        overflow: auto;
        background: var(--json-bg, transparent);
        user-select: text; /* Allow text selection in details */
        cursor: text; /* Show text cursor */
      }

      /* Fullscreen details (Space in details pane) */

      .nx-details--fullscreen {
        position: fixed;
        inset: 8px;
        z-index: 20;
        border-radius: 0; /* Square corners for DOS feel */
        border: 1px solid var(--accent-strong, #ffcc00);
        background: var(--panel, #0f131a);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
      }

      .nx-details--fullscreen .nx-pane-body {
        padding: 0;
      }

      /* JSON syntax highlighting (using theme tokens) */

      .nx-json-key {
        color: var(--json-key, #d19a66);
      }
      .nx-json-string {
        color: var(--json-string, #98c379);
      }
      .nx-json-number {
        color: var(--json-number, #d19a66);
      }
      .nx-json-bool {
        color: var(--json-bool, #56b6c2);
      }
      .nx-json-null {
        color: var(--json-struct, #5c6370);
        font-style: italic;
      }

      /* Footer */

      #nearx-footer {
        height: 18px;
        font-size: 15px;  /* smaller than body (20px) for status bar */
        border-top: 1px solid var(--border, #5d636d);
        display: flex;
        align-items: center;
        padding: 0 4px;
        color: var(--fg-dim, #9ca3af);
      }

      /* Toast */

      #nearx-toast {
        position: fixed;
        bottom: 12px;
        right: 12px;
        padding: 6px 10px;
        border-radius: 0; /* Square corners for DOS feel */
        background: var(--panel-alt, #111827);
        border: 1px solid var(--success, #6bdc96);
        color: var(--success, #6bdc96);
        font-weight: bold;
        font-size: 15px;
        max-width: 360px;
        white-space: pre-wrap;
      }

      /* Help modal */

      .nx-modal {
        position: fixed;
        inset: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Hide modal by default (show only when user presses ?) */
      .nx-modal.hidden {
        display: none !important;
      }

      .nx-modal-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
      }

      .nx-modal-content {
        position: relative;
        background: var(--panel-alt, #1a2030);
        border: 2px solid var(--accent-strong, #ffcc00);
        border-radius: 0; /* Square corners for DOS feel */
        padding: 2rem;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      }

      .nx-modal-content h2 {
        margin-top: 0;
        color: var(--accent-strong, #ffcc00);
        font-size: 1.5rem;
      }

      .nx-shortcuts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin: 1.5rem 0;
      }

      .nx-shortcut-group h3 {
        font-size: 0.875rem;
        text-transform: uppercase;
        color: var(--fg-dim, #9ca3af);
        margin-bottom: 0.75rem;
        border-bottom: 1px solid var(--border, #5d636d);
        padding-bottom: 0.25rem;
      }

      .nx-shortcut-group > div {
        margin: 0.5rem 0;
        display: flex;
        align-items: baseline;
        gap: 0.5rem;
      }

      .nx-shortcut-group kbd {
        display: inline-block;
        padding: 0.125rem 0.375rem;
        background: var(--panel, #0f131a);
        border: 1px solid var(--border, #5d636d);
        border-radius: 0; /* Square corners */
        font-family: inherit;
        font-size: 0.75rem;
        color: var(--accent-strong, #ffcc00);
        margin-right: 0.25rem;
      }

      .nx-shortcut-group span {
        color: var(--fg-dim, #9ca3af);
        font-size: 0.875rem;
      }

      .nx-modal-close {
        display: block;
        margin: 1rem auto 0;
        padding: 0.5rem 1.5rem;
        background: var(--accent-strong, #ffcc00);
        color: var(--bg, #0b0e14);
        border: none;
        border-radius: 0; /* Square corners */
        cursor: pointer;
        font-weight: bold;
        font-size: 0.875rem;
      }

      .nx-modal-close:hover {
        opacity: 0.9;
      }

      /* Copy animation feedback */

      @keyframes flash-copy {
        0%, 100% {
          border-color: var(--accent-strong, #ffcc00);
          box-shadow: 0 0 0 1px rgba(255, 204, 0, 0.3);
        }
        50% {
          border-color: var(--success, #6bdc96);
          box-shadow: 0 0 12px rgba(107, 220, 150, 0.6);
        }
      }

      .nx-flash-copied {
        animation: flash-copy 300ms ease;
      }

      /* Loading indicator for archival fetch */

      .nx-loading {
        color: var(--fg-dim, #9ca3af);
        font-style: italic;
        animation: pulse-loading 1.5s ease-in-out infinite;
      }

      @keyframes pulse-loading {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
    </style>
  </head>
  <body>
    <div id="nearx-root">
      <div id="nearx-filter-row">
        <input
          id="nearx-filter"
          type="text"
          placeholder="Filter (press / or f to focus)…"
          autocomplete="off"
          aria-label="Filter transactions"
          aria-describedby="filter-hint"
        />
        <span id="filter-hint" class="sr-only">
          Type filter query. Use signer:, receiver:, action:, or method: prefixes. Press Escape to clear.
        </span>
      </div>

      <div id="nearx-body">
        <div id="nearx-top-row">
          <div id="pane-blocks" class="nx-pane" role="region" aria-label="Blocks panel" tabindex="0">
            <div id="pane-blocks-title" class="nx-pane-title">
              Blocks <span class="nx-shortcut-hint" style="opacity: 0.6; font-size: 12px;">↑↓ jk • Enter select</span>
            </div>
            <div id="selection-slot" class="nx-selection-slot"></div>
            <div id="pane-blocks-body" class="nx-pane-body" role="listbox"></div>
          </div>
          <div id="pane-txs" class="nx-pane" role="region" aria-label="Transactions panel" tabindex="0">
            <div id="pane-txs-title" class="nx-pane-title">
              Tx hashes <span class="nx-shortcut-hint" style="opacity: 0.6; font-size: 12px;">↑↓ jk • c copy</span>
            </div>
            <div id="pane-txs-body" class="nx-pane-body" role="listbox"></div>
          </div>
        </div>

        <div id="pane-details" class="nx-pane" role="region" aria-label="Transaction details panel" tabindex="0">
          <div id="pane-details-title" class="nx-pane-title">
            Transaction details <span class="nx-shortcut-hint" style="opacity: 0.6; font-size: 12px;">c copy • Space expand</span>
          </div>
          <div class="nx-pane-body">
            <pre id="pane-details-pre" aria-live="polite"></pre>
          </div>
        </div>
      </div>

      <div id="nearx-footer"></div>
    </div>

    <div id="nearx-toast" role="status" aria-live="polite" aria-atomic="true" hidden></div>

    <!-- Keyboard shortcuts help modal -->
    <div id="nearx-help-modal" class="nx-modal hidden">
      <div class="nx-modal-backdrop"></div>
      <div class="nx-modal-content">
        <h2>Keyboard Shortcuts</h2>
        <div class="nx-shortcuts-grid">
          <div class="nx-shortcut-group">
            <h3>Navigation</h3>
            <div><kbd>Tab</kbd> / <kbd>Shift+Tab</kbd> <span>Cycle panes</span></div>
            <div><kbd>↑</kbd> / <kbd>↓</kbd> or <kbd>j</kbd> / <kbd>k</kbd> <span>Navigate lists</span></div>
            <div><kbd>←</kbd> / <kbd>→</kbd> or <kbd>h</kbd> / <kbd>l</kbd> <span>Horizontal focus</span></div>
            <div><kbd>PageUp</kbd> / <kbd>PageDown</kbd> <span>Page scroll</span></div>
            <div><kbd>Home</kbd> / <kbd>End</kbd> <span>Jump to start/end</span></div>
          </div>
          <div class="nx-shortcut-group">
            <h3>Actions</h3>
            <div><kbd>/</kbd> or <kbd>f</kbd> <span>Focus filter</span></div>
            <div><kbd>c</kbd> <span>Copy focused JSON</span></div>
            <div><kbd>Space</kbd> <span>Toggle fullscreen details</span></div>
            <div><kbd>Esc</kbd> <span>Exit fullscreen / clear filter</span></div>
            <div><kbd>Enter</kbd> <span>Select item</span></div>
          </div>
          <div class="nx-shortcut-group">
            <h3>Mouse</h3>
            <div>Click row → Focus + select</div>
            <div>Double-click details → Fullscreen</div>
            <div>Scroll wheel → Navigate pane</div>
          </div>
        </div>
        <button class="nx-modal-close">Close (Esc or ?)</button>
      </div>
    </div>

    <!-- platform / bridge shims -->
    <script src="./open_desktop.js"></script>
    <script src="./auth.js"></script>
    <script src="./router_shim.js"></script>
    <script src="./platform.js"></script>

    <!-- DOM frontend entrypoint -->
    <script type="module" src="./app.js"></script>
  </body>
</html>
